/* @pollon/knockout - v1.0.0
* https://github.com/pollon-js/knockout#readme
* 2020 Francesco Lasaracina. Licensed ISC */
System.register(["@pollon/pollon"],(function(e){"use strict";var t;return{setters:[function(e){t=e.TemplateLoader}],execute:function(){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}var u=function(e){function t(e,r){var o;return n(this,t),(o=l(this,i(t).call(this,e))).extension=r||".jpt",o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,e),o(t,[{key:"get",value:function(e,n){var r=this;return this.canParse(n)?function(e){return!!document.querySelector('script[id="'.concat(e,'"]'))}(e)?Promise.resolve():new Promise((function(o,a){return c(i(t.prototype),"get",r).call(r,n).then((function(t){var n,r;(n=document.createElement("template")).innerHTML='<script type="text/template" id="'.concat(e,'">').concat(t.trim(),"<\/script>"),r=n.content,document.body.appendChild(r),o(t)})).catch((function(e){console.warn(e),a(e)}))})):Promise.reject("Pollon: [loader:knockout-partials] ".concat(n," element is unparseable by a Partial template loader"))}},{key:"onUnloadable",value:function(e,n,r){return c(i(t.prototype),"onUnloadable",this).call(this,e,n,r).then((function(e){return console.warn("Pollon: [loader:knockout-partials] Partial Template loader: message"),""})).catch((function(e){return console.warn("Pollon: [loader:knockout-partials] Partial Template loader: message"),""}))}}]),t}(t),s=function(e,t){e.bindingHandlers.excludeFromBinding||(e.bindingHandlers.excludeFromBinding={init:function(e,t,n){return{controlsDescendantBindings:!0}}},e.virtualElements.allowedBindings.excludeFromBinding=!0);var n=function(n,r,o,i,a){return function(){return function(){var n,o,i,a;return n=e.utils.unwrapObservable(r()),i=null,a=n,"string"==Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1].toLowerCase()?(o=n,void t.navigate(o)):function(e){return"object"==Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1].toLowerCase()}(n)?(o=e.utils.unwrapObservable(n.to),i=e.utils.unwrapObservable(n.data),o||""===o?null==i?void t.navigate(o):void t.navigate(o,i):void console.warn("Pollon [router:invalid-parameter]: cannot navigate to route. Invalid parameter passed in binding")):void 0}}};e.bindingHandlers.navigate||(e.bindingHandlers.navigate={init:function(t,r,o,i,a){var l=n(0,r);e.bindingHandlers.click.init(t,l,o,i,a)}}),e.bindingHandlers.afterHtmlRender||(e.bindingHandlers.afterHtmlRender={update:function(e,t,n){n().html&&t()(n().html)}})};e("default",function(){function e(t){n(this,e),this.modules=[],this.ko=null}return o(e,[{key:"init",value:function(e){var t=this;if(!this.ko)return e.load("knockout").then((function(n){t.ko=n,s(n,e),e.Templates.KnockoutPartials=new u(e.name)}))}},{key:"applyBindings",value:function(e,t,n){var r,o=this;return r=(r=n&&n.View&&n.View.Model)||{},Promise.resolve().then((function(){o.modules[e.name+":"+n.ID]||n.Runtime.FSM.on("statemachine.state_entered","disposed",(function(e,t){o.ko.cleanNode(t.args[0])})),o.modules[e.name+":"+n.ID]=!0;var i=o.ko.dataFor(t);return i&&i===r||o.ko.applyBindings(r,t),t}))}}]),e}())}}}));
