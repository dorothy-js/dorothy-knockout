/* @pollon/knockout - v1.0.0
* https://github.com/pollon-js/knockout#readme
* 2020 Francesco Lasaracina. Licensed ISC */
define(["@pollon/pollon"],(function(e){"use strict";function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function t(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,n){return(i=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function a(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function l(e,n,t){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,t){var o=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=r(e)););return e}(e,n);if(o){var i=Object.getOwnPropertyDescriptor(o,n);return i.get?i.get.call(t):i.value}})(e,n,t||e)}var c=function(e){function t(e,o){var i;return n(this,t),(i=a(this,r(t).call(this,e))).extension=o||".jpt",i}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&i(e,n)}(t,e),o(t,[{key:"get",value:function(e,n){var o=this;return this.canParse(n)?function(e){return!!document.querySelector('script[id="'.concat(e,'"]'))}(e)?Promise.resolve():new Promise((function(i,a){return l(r(t.prototype),"get",o).call(o,n).then((function(n){var t,o;(t=document.createElement("template")).innerHTML='<script type="text/template" id="'.concat(e,'">').concat(n.trim(),"<\/script>"),o=t.content,document.body.appendChild(o),i(n)})).catch((function(e){console.warn(e),a(e)}))})):Promise.reject("Pollon: [loader:knockout-partials] ".concat(n," element is unparseable by a Partial template loader"))}},{key:"onUnloadable",value:function(e,n,o){return l(r(t.prototype),"onUnloadable",this).call(this,e,n,o).then((function(e){return console.warn("Pollon: [loader:knockout-partials] Partial Template loader: message"),""})).catch((function(e){return console.warn("Pollon: [loader:knockout-partials] Partial Template loader: message"),""}))}}]),t}(e.TemplateLoader),u=function(e,n){e.bindingHandlers.excludeFromBinding||(e.bindingHandlers.excludeFromBinding={init:function(e,n,t){return{controlsDescendantBindings:!0}}},e.virtualElements.allowedBindings.excludeFromBinding=!0);var t=function(t,o,r,i,a){return function(){return function(){var t,r,i,a;return t=e.utils.unwrapObservable(o()),i=null,a=t,"string"==Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1].toLowerCase()?(r=t,void n.navigate(r)):function(e){return"object"==Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1].toLowerCase()}(t)?(r=e.utils.unwrapObservable(t.to),i=e.utils.unwrapObservable(t.data),r||""===r?null==i?void n.navigate(r):void n.navigate(r,i):void console.warn("Pollon [router:invalid-parameter]: cannot navigate to route. Invalid parameter passed in binding")):void 0}}};e.bindingHandlers.navigate||(e.bindingHandlers.navigate={init:function(n,o,r,i,a){var l=t(0,o);e.bindingHandlers.click.init(n,l,r,i,a)}}),e.bindingHandlers.afterHtmlRender||(e.bindingHandlers.afterHtmlRender={update:function(e,n,t){t().html&&n()(t().html)}})};return function(){function e(t){n(this,e),this.modules=[],this.ko=null}return o(e,[{key:"init",value:function(e){var n=this;if(!this.ko)return e.load("knockout").then((function(t){n.ko=t,u(t,e),e.Templates.KnockoutPartials=new c(e.name)}))}},{key:"applyBindings",value:function(e,n,t){var o,r=this;return o=(o=t&&t.View&&t.View.Model)||{},Promise.resolve().then((function(){r.modules[e.name+":"+t.ID]||t.Runtime.FSM.on("statemachine.state_entered","disposed",(function(e,n){r.ko.cleanNode(n.args[0])})),r.modules[e.name+":"+t.ID]=!0;var i=r.ko.dataFor(n);return i&&i===o||r.ko.applyBindings(o,n),n}))}}]),e}()}));
